<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Routine — CampusCare</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="../assets/css/styles.css">
</head>

<body>

  <header class="glass"
    style="position: sticky; top: 20px; z-index: 1000; display: flex; justify-content: space-between; align-items: center; margin: 0 auto; width: 95%; max-width: 1400px; border-radius: 16px;">
    <a href="index.html" class="logo" style="text-decoration: none; display: flex; align-items: center; gap: 10px;">
      <i class="fa-solid fa-graduation-cap"></i> CampusCare
    </a>
    <!-- USER PROFILE -->
    <div style="display:flex; align-items:center; gap: 20px;">
      <a href="index.html" class="dashboard-btn-nav"
        style="text-decoration:none; color: #2d3748; font-weight: 600; font-size: 1rem; transition: color 0.3s ease;">
        Dashboard
      </a>
      <div id="userProfile" style="display: none; align-items: center; gap: 10px; position: relative; cursor: pointer;">
        <span id="userName" style="font-weight: 600; color: #2d3748;">Hello, User</span>
        <img id="userAvatar" src="https://ui-avatars.com/api/?name=User&background=random" alt="Profile"
          style="width: 40px; height: 40px; border-radius: 50%; border: 2px solid #ccc;" onclick="toggleProfileMenu()">

        <!-- DROPDOWN MENU -->
        <div id="profileMenu" class="glass"
          style="display: none; position: absolute; top: 50px; right: 0; flex-direction: column; width: 200px; padding: 1rem; background: white; z-index: 2000; text-align: left;">
          <p
            style="border-bottom: 1px solid #eee; padding-bottom: 0.5rem; margin-bottom: 0.5rem; font-weight: bold; font-size: 0.9rem;">
            Account Details
          </p>
          <p id="userDetails" style="font-size: 0.85rem; color: #666; margin-bottom: 1rem;">
            <!-- Injected by JS -->
          </p>
          <button onclick="logout()"
            style="background: #ef4444; color: white; border: none; padding: 0.5rem; width: 100%; border-radius: 5px; cursor: pointer;">
            <i class="fa-solid fa-right-from-bracket"></i> Logout
          </button>
        </div>
      </div>
    </div>
  </header>

  <main class="inner-page standard-container">

    <div
      style="margin-top: 4rem; margin-bottom: 2rem; display: flex; justify-content: space-between; align-items: center;">
      <h1 class="page-title">Class Routine</h1>
      <select id="batch-select"
        style="padding: 0.5rem; border-radius: 8px; border: 1px solid #cbd5e1; background: white; font-family: 'Poppins';">
        <option value="A">Batch A (CS-2025)</option>
        <option value="B">Batch B (IT-2025)</option>
        <option value="C">Batch C (ECE-2025)</option>
      </select>
    </div>

    <!-- EXCEL STYLE GRID -->
    <!-- Changed to list-card to stop whole box hovering -->
    <div class="list-card" style="padding: 1rem; overflow-x: auto; align-items: stretch; text-align: left;">
      <div id="routine-container" style="width: 100%;">
        <div style="text-align: center; padding: 2rem; color: #64748b;">
          <i class="fa-solid fa-spinner fa-spin"></i> Loading...
        </div>
      </div>
    </div>

  </main>

  <style>
    /* Excel Grid Styles */
    .routine-table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
      min-width: 800px;
      /* Force scroll on small screens */
    }

    .routine-table th,
    .routine-table td {
      border: none;
      /* Remove all borders */
      border-bottom: 1px solid rgba(203, 213, 225, 0.5);
      /* Subtle row separators */
      padding: 1.5rem 1rem;
      /* Bigger padding */
      text-align: center;
      font-size: 1rem;
      /* Larger font */
    }

    .routine-table th {
      background: transparent;
      color: #64748b;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      border-bottom: 2px solid #cbd5e1;
    }

    .routine-table td {
      background: rgba(255, 255, 255, 0.9);
      color: #475569;
      transition: all 0.2s ease;
    }

    /* ROW Hover Effect */
    .routine-table tbody tr {
      transition: all 0.3s ease;
    }

    .routine-table tbody tr:hover td {
      background: linear-gradient(135deg, #00aeff 0, #c121e9 100%);
      color: white !important;
      border-color: rgba(255, 255, 255, 0.1);
    }

    /* Ensure top-left and top-right radius for the whole row on hover if possible, 
       but standard table rows are tricky. We'll just color the cells. 
       To make the whole row "pop", we can try transforming the cells or the row? 
       Transforms on TR are sometimes flaky. Let's do scale on cells.
    */
    .routine-table tbody tr:hover td:first-child {
      border-top-left-radius: 10px;
      border-bottom-left-radius: 10px;
    }

    .routine-table tbody tr:hover td:last-child {
      border-top-right-radius: 10px;
      border-bottom-right-radius: 10px;
    }

    .current-day {
      background: #eff6ff !important;
      border: 2px solid #3b82f6 !important;
      position: relative;
    }

    .current-day::after {
      content: 'TODAY';
      position: absolute;
      top: -8px;
      right: -8px;
      background: #3b82f6;
      color: white;
      font-size: 0.6rem;
      padding: 2px 6px;
      border-radius: 10px;
      font-weight: bold;
      z-index: 5;
    }

    /* Override hover for current day to keep it distinct or merge? 
       User said "hover reflect over entire row". 
       So row hover should probably take precedence or blend.
    */
  </style>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const dbSelect = document.getElementById('batch-select');
      const container = document.getElementById('routine-container');

      // MOCK DATA GENERATOR
      const generateRoutine = (batch) => {
        return {
          'Monday': ['Maths (10-11)', 'Physics (11-12)', 'Break', 'CS Lab (1-3)', 'Library'],
          'Tuesday': ['Chemistry (10-11)', 'English (11-12)', 'Break', 'Workshop (1-4)'],
          'Wednesday': ['Maths (10-11)', 'Physics (11-12)', 'Break', 'Sports', 'Self Study'],
          'Thursday': ['OS (10-11)', 'DBMS (11-12)', 'Break', 'Placement Trg', 'Mentoring'],
          'Friday': ['Project (9-12)', 'Break', 'Maths (1-2)', 'Club Activity']
        };
      };

      const renderRoutine = (batch) => {
        const days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday'];
        const timeSlots = ['10:00 - 11:00', '11:00 - 12:00', '12:00 - 01:00', '01:00 - 02:00', '02:00 - 04:00'];
        // Simplified Logic: Just projecting subjects into slots for the Excel look

        const routineData = generateRoutine(batch);
        const todayName = new Date().toLocaleDateString('en-US', { weekday: 'long' });

        let html = '<table class="routine-table">';
        html += '<thead><tr><th>Day / Time</th>';
        timeSlots.forEach(t => html += `<th>${t}</th>`);
        html += '</tr></thead><tbody>';

        days.forEach(day => {
          const isToday = day === todayName;
          const subjects = routineData[day] || [];

          html += `<tr class="${isToday ? 'current-day' : ''}">`;
          html += `<td style="font-weight:bold;">${day}</td>`;

          // Fill slots (mock logic: just take first 5 items from array)
          for (let i = 0; i < 5; i++) {
            html += `<td>${subjects[i] || '-'}</td>`;
          }
          html += '</tr>';
        });

        html += '</tbody></table>';
        container.innerHTML = html;
      };

      // Initial Render
      renderRoutine('A');

      // Change Handler
      dbSelect.addEventListener('change', (e) => {
        container.innerHTML = '<div style="text-align:center; padding:2rem;"><i class="fa-solid fa-spinner fa-spin"></i> Updating Batch...</div>';
        setTimeout(() => renderRoutine(e.target.value), 500);
      });

    });
  </script>

  <!-- Removed Duplicate Footer (using global footer margin-top: auto) -->
  <!-- But keeping footer tag as per request to have it at bottom -->
  <footer class="site-footer">
    <p>© 2025 CampusCare</p>
  </footer>

  <!-- FLOATING ACTION BUTTONS (SOS & AI) -->
  <div class="fab-container"
    style="position: fixed; bottom: 30px; right: 30px; z-index: 1000; display: flex; flex-direction: column; gap: 15px; align-items: flex-end;">
    <button onclick="toggleModal('ai-modal')"
      style="width: 60px; height: 60px; border-radius: 50%; border: none; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; font-size: 1.5rem; cursor: pointer; box-shadow: 0 4px 15px rgba(0,0,0,0.2); transition: transform 0.3s ease;">
      <i class="fa-solid fa-robot"></i>
    </button>
    <button onclick="toggleModal('sos-modal')"
      style="width: 60px; height: 60px; border-radius: 50%; border: none; background: #ef4444; color: white; font-size: 1.5rem; cursor: pointer; box-shadow: 0 4px 15px rgba(239, 68, 68, 0.4); animation: pulse-red 2s infinite;">
      <i class="fa-solid fa-bell-concierge"></i>
    </button>
  </div>

  <!-- SOS MODAL -->
  <div id="sos-modal" class="modal-overlay"
    style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 2000; justify-content: center; align-items: center;">
    <div class="modal-content glass"
      style="background: #fff; padding: 2rem; border-radius: 20px; width: 90%; max-width: 400px; text-align: center; position: relative;">
      <button onclick="toggleModal('sos-modal')"
        style="position: absolute; top: 10px; right: 15px; background: none; border: none; font-size: 1.5rem; cursor: pointer;">&times;</button>
      <i class="fa-solid fa-triangle-exclamation" style="font-size: 3rem; color: #ef4444; margin-bottom: 1rem;"></i>
      <h2 style="color: #ef4444; margin-bottom: 0.5rem;">EMERGENCY SOS</h2>
      <p style="margin-bottom: 1.5rem;">Select your emergency type to alert nearest help.</p>
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
        <a href="tel:100"
          style="background: #1f2937; color: white; padding: 10px; border-radius: 10px; text-decoration: none; font-weight: bold; grid-column: 1 / -1;"><i
            class="fa-solid fa-shield-halved"></i> Call Security / Police</a>
        <button onclick="alert('Requesting First Aid Kit... Warden Notified!')"
          style="background: #f59e0b; color: white; padding: 15px; border-radius: 10px; border: none; cursor: pointer; font-weight: bold; display:flex; flex-direction:column; align-items:center; gap:5px;"><i
            class="fa-solid fa-kit-medical" style="font-size:1.5rem;"></i> First Aid</button>
        <button
          onclick="const bg = prompt('Please enter the required Blood Group (e.g. O+):'); if(bg) alert(`Broadcasting Blood Requirement (${bg}) Alert to Campus!`)"
          style="background: #ef4444; color: white; padding: 15px; border-radius: 10px; border: none; cursor: pointer; font-weight: bold; display:flex; flex-direction:column; align-items:center; gap:5px;"><i
            class="fa-solid fa-droplet" style="font-size:1.5rem;"></i> Need Blood</button>
        <a href="tel:101"
          style="background: #ef4444; color: white; padding: 10px; border-radius: 10px; text-decoration: none; font-weight: bold; display:flex; justify-content:center; align-items:center; gap:5px;"><i
            class="fa-solid fa-truck-medical"></i> Ambulance</a>
        <button onclick="alert('Panic Signal Sent with Location!')"
          style="background: #4b5563; color: white; padding: 10px; border-radius: 10px; border: none; cursor: pointer; font-weight: bold;">Other
          / Panic</button>
      </div>
    </div>
  </div>

  <!-- AI ASSISTANT MODAL -->
  <div id="ai-modal" class="modal-overlay"
    style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 2000; justify-content: center; align-items: center;">
    <div class="modal-content glass"
      style="background: #fff; padding: 2rem; border-radius: 20px; width: 90%; max-width: 400px; text-align: center; position: relative;">
      <button onclick="toggleModal('ai-modal')"
        style="position: absolute; top: 10px; right: 15px; background: none; border: none; font-size: 1.5rem; cursor: pointer;">&times;</button>
      <i class="fa-solid fa-robot" style="font-size: 3rem; color: #667eea; margin-bottom: 1rem;"></i>
      <h2 style="color: #1f2937; margin-bottom: 0.5rem;">Campus AI Assistant</h2>
      <div id="ai-chat-history"
        style="text-align: left; max-height: 300px; overflow-y: auto; margin-bottom: 1rem; border: 1px solid #eee; padding: 10px; border-radius: 10px; background: #f9fafb; display:none;">
      </div>
      <input type="text" id="ai-input" placeholder="Ask about routine, hostel..."
        style="width: 100%; padding: 10px; border-radius: 10px; border: 1px solid #ccc; margin-bottom: 1rem;">
      <button onclick="askAI()"
        style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 10px 20px; border-radius: 10px; border: none; cursor: pointer; font-weight: bold;">Ask
        AI</button>
    </div>
  </div>

  <script>function toggleModal(id) { const m = document.getElementById(id); if (m.style.display === 'flex') { m.style.display = 'none'; } else { m.style.display = 'flex'; } }</script>
  <script src="../assets/js/landing.js"></script>
  <script src="../assets/js/ai.js"></script>
</body>

</html>